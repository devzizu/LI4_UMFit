{"ast":null,"code":"var _jsxFileName = \"/home/joao/Desktop/Projeto-LI4/li4_umfit/UMFit-WebApp/UMFit-Client/UMFit-App/src/App.tsx\";\nimport React from 'react';\nimport { Redirect, Route } from 'react-router-dom';\nimport { IonApp, IonRouterOutlet, IonSplitPane, IonPage, IonHeader, IonToolbar, IonTitle, IonText, IonInput, IonButton, IonItem, IonCheckbox, IonLabel } from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\n/* Core CSS required for Ionic components to work properly */\n\nimport '@ionic/react/css/core.css';\n/* Basic CSS for apps built with Ionic */\n\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n/* Optional CSS utils that can be commented out */\n\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n/* Theme variables */\n\nimport './theme/variables.css'; //---------------------------------------------------------------------------------------\n//---------------------------------------------------------------------------------------\n\nimport { authenticate, getUserStatus, logout } from './models/API/UserAPI';\nimport { User } from './models/Other/User';\nimport sha256 from \"fast-sha256\"; //---------------------------------------------------------------------------------------\n//---------------------------------------------------------------------------------------\n\nimport './components/css/LogIn.css';\nimport './pages/css/Home.css';\nimport Menu from './components/MenuHome';\nimport About from './pages/About';\nimport Contact from './pages/Contact';\nimport UserProfile from './pages/UserProfile'; //---------------------------------------------------------------------------------------\n\nclass App extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = void 0;\n\n    this.setRememberMe = rM => {\n      this.setState({\n        rememberMe: rM\n      });\n    };\n\n    this.setLogged = logged => {\n      if (logged === false) {\n        logout(this.state.userLogged.email);\n        localStorage.clear();\n      }\n\n      this.setState({\n        logged: logged,\n        menus: logged ? 'user' : 'home'\n      });\n    };\n\n    this.setUser = user => {\n      this.setState({\n        userLogged: user\n      });\n    };\n\n    this.state = {\n      selectedPage: '',\n      menus: 'home',\n      logged: false,\n      loadingAPIcall: true,\n      userLogged: new User(\"\", \"\", -1, \"\", -1, \"\", \"\", \"\"),\n      rememberMe: false\n    };\n  }\n\n  async componentDidMount() {\n    console.log(\"com..DidMount() -> updating state...\"); //await getUserStatus(this.state.userLogged.email)\n    //await getUserStatus(\"test\")\n\n    var emailFromStorage = localStorage.getItem('email');\n    console.log(\"Remember? \" + this.state.rememberMe);\n    if (emailFromStorage === null) emailFromStorage = this.state.userLogged.email;else {\n      var userFromStorage = localStorage.getItem('user');\n\n      if (userFromStorage != null) {\n        this.setState({\n          userLogged: JSON.parse(userFromStorage)\n        });\n      }\n    }\n    await getUserStatus(emailFromStorage).then(res => res.json()).then(data => {\n      if (data.status === \"online\") {\n        this.setState({\n          logged: true,\n          menus: 'user',\n          loadingAPIcall: false\n        });\n      } else {\n        this.setState({\n          logged: false,\n          menus: 'home',\n          loadingAPIcall: false\n        });\n      }\n    });\n  }\n\n  render() {\n    console.log(\"[...] Rendering App component...\");\n    var logged = this.state.logged;\n    return React.createElement(IonApp, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 151\n      },\n      __self: this\n    }, this.state.loadingAPIcall ? React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 153\n      },\n      __self: this\n    }) : React.createElement(IonReactRouter, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 154\n      },\n      __self: this\n    }, React.createElement(IonSplitPane, {\n      id: \"split-pane\",\n      contentId: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 156\n      },\n      __self: this\n    }, React.createElement(Menu, {\n      selectedPage: this.state.selectedPage,\n      menus: this.state.menus,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 157\n      },\n      __self: this\n    }), React.createElement(IonRouterOutlet, {\n      id: \"main\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 159\n      },\n      __self: this\n    }, React.createElement(Route, {\n      path: \"/home\",\n      component: props => {\n        if (logged) {\n          return React.createElement(Redirect, {\n            to: \"/profile\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 165\n            },\n            __self: this\n          });\n        }\n\n        return React.createElement(Home, Object.assign({\n          logged: logged\n        }, props, {\n          setLogged: this.setLogged,\n          setUser: this.setUser,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 168\n          },\n          __self: this\n        }));\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 161\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/about\",\n      component: About,\n      exact: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 171\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/contact\",\n      component: Contact,\n      exact: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/profile\",\n      component: props => {\n        if (!logged) {\n          return React.createElement(Redirect, {\n            to: \"/home\",\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 178\n            },\n            __self: this\n          });\n        }\n\n        return React.createElement(Profile, {\n          setLogged: this.setLogged,\n          user: this.state.userLogged,\n          setRememberMe: this.state.setRememberMe,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 181\n          },\n          __self: this\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 174\n      },\n      __self: this\n    }), React.createElement(Redirect, {\n      exact: true,\n      from: \"/\",\n      to: \"/home\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 185\n      },\n      __self: this\n    })))));\n  }\n\n}\n\n;\nexport default App; //---------------------------------------------------------------------------------------\n\nclass Home extends React.Component {\n  render() {\n    return React.createElement(IonPage, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 209\n      },\n      __self: this\n    }, React.createElement(IonHeader, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 212\n      },\n      __self: this\n    }, React.createElement(IonToolbar, {\n      color: \"primary\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, React.createElement(IonTitle, {\n      id: \"page-title\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, \"UMFit\"))), React.createElement(LogInForm, {\n      logged: this.props.logged,\n      history: this.props.history,\n      setLogged: this.props.setLogged,\n      setUser: this.props.setUser,\n      setRememberMe: this.props.setRememberMe,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 218\n      },\n      __self: this\n    }));\n  }\n\n}\n\n; //---------------------------------------------------------------------------------------\n\nclass Profile extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      user: User\n    };\n    this.state = {\n      user: this.props.user\n    };\n  }\n\n  render() {\n    return React.createElement(IonRouterOutlet, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 245\n      },\n      __self: this\n    }, React.createElement(Route, {\n      path: \"/profile\",\n      render: () => {\n        return React.createElement(UserProfile, {\n          user: this.state.user,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 247\n          },\n          __self: this\n        });\n      },\n      exact: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 247\n      },\n      __self: this\n    }), React.createElement(Route, {\n      path: \"/profile/logout\",\n      component: () => {\n        return React.createElement(LogOut, {\n          setLogged: this.props.setLogged,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 249\n          },\n          __self: this\n        });\n      },\n      exact: true,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 249\n      },\n      __self: this\n    }));\n  }\n\n} //---------------------------------------------------------------------------------------\n\n\nclass LogOut extends React.Component {\n  componentDidMount() {\n    this.props.setLogged(false);\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 266\n      },\n      __self: this\n    });\n  }\n\n} //---------------------------------------------------------------------------------------\n\n\nclass LogInForm extends React.Component {\n  constructor(props) {\n    super(props);\n    this.state = void 0;\n    this.state = {\n      emailValue: \"\",\n      passwordValue: \"\",\n      rememberMe: false\n    };\n  }\n\n  render() {\n    return React.createElement(\"div\", {\n      id: \"login-form\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 295\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      id: \"Logo\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 296\n      },\n      __self: this\n    }), React.createElement(\"div\", {\n      id: \"phrase\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 297\n      },\n      __self: this\n    }, React.createElement(IonText, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 298\n      },\n      __self: this\n    }, \"O teu gin\\xE1sio da UMinho...\")), React.createElement(\"div\", {\n      id: \"input-form\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 300\n      },\n      __self: this\n    }, React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 301\n      },\n      __self: this\n    }), React.createElement(IonInput, {\n      required: true,\n      type: \"email\",\n      id: \"email-input\",\n      placeholder: \"E-Mail\",\n      value: this.state.emailValue,\n      onIonChange: e => {\n        this.setState({\n          emailValue: e.target.value\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 302\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 312\n      },\n      __self: this\n    }), React.createElement(IonInput, {\n      required: true,\n      type: \"password\",\n      id: \"pass-input\",\n      placeholder: \"Password\",\n      value: this.state.passwordValue,\n      onIonChange: e => {\n        this.setState({\n          passwordValue: e.target.value\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 313\n      },\n      __self: this\n    }), React.createElement(\"br\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 323\n      },\n      __self: this\n    }), React.createElement(IonItem, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 324\n      },\n      __self: this\n    }, React.createElement(IonCheckbox, {\n      color: \"primary\",\n      slot: \"start\",\n      onIonChange: e => {\n        this.setState({\n          rememberMe: e.target.checked\n        });\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 325\n      },\n      __self: this\n    }), React.createElement(IonLabel, {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 330\n      },\n      __self: this\n    }, \"Remember me\"))), React.createElement(\"div\", {\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 333\n      },\n      __self: this\n    }, React.createElement(IonButton, {\n      expand: \"block\",\n      type: \"submit\",\n      id: \"login-button\",\n      onClick: async () => {\n        //setShowLoading(true);\n        let pass_enc = new TextEncoder();\n        let encoded = pass_enc.encode(this.state.passwordValue);\n        let hash256 = Buffer.from(sha256(encoded)).toString('hex').toUpperCase();\n        console.log(\"Para a API: /api/user/authenticate\");\n        console.log(\"> E-Mail: \" + this.state.emailValue);\n        console.log(\"> Password: \" + this.state.passwordValue);\n        console.log(\"> Password (sha256): \" + hash256); //request\n\n        let response = authenticate(this.state.emailValue, this.state.passwordValue);\n        await response.then(async value => {\n          //Success OK = 200    \n          if (value.status === 200) {\n            var json = value.json(); //var json: User = await value.json();\n\n            await json.then(value => {\n              var user = value;\n              this.props.setLogged(true);\n              this.props.setUser(user);\n              this.props.setRememberMe(this.state.rememberMe);\n              localStorage.setItem(\"email\", user.email);\n              localStorage.setItem(\"user\", JSON.stringify(user)); //this.props.history.replace(\"/profile\");\n            }); //Login error: 400    \n          } else {\n            alert(\"E-mail ou password incorretos...\");\n          }\n        }); //for debug\n        //this.props.setLogged(true);\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 334\n      },\n      __self: this\n    }, \"Log-In\")));\n  }\n\n}\n\n;","map":{"version":3,"sources":["/home/joao/Desktop/Projeto-LI4/li4_umfit/UMFit-WebApp/UMFit-Client/UMFit-App/src/App.tsx"],"names":["React","Redirect","Route","IonApp","IonRouterOutlet","IonSplitPane","IonPage","IonHeader","IonToolbar","IonTitle","IonText","IonInput","IonButton","IonItem","IonCheckbox","IonLabel","IonReactRouter","authenticate","getUserStatus","logout","User","sha256","Menu","About","Contact","UserProfile","App","Component","constructor","props","state","setRememberMe","rM","setState","rememberMe","setLogged","logged","userLogged","email","localStorage","clear","menus","setUser","user","selectedPage","loadingAPIcall","componentDidMount","console","log","emailFromStorage","getItem","userFromStorage","JSON","parse","then","res","json","data","status","render","Home","history","Profile","LogOut","LogInForm","emailValue","passwordValue","e","target","value","checked","pass_enc","TextEncoder","encoded","encode","hash256","Buffer","from","toString","toUpperCase","response","setItem","stringify","alert"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Redirect, Route } from 'react-router-dom';\nimport { IonApp, IonRouterOutlet, IonSplitPane, IonPage, IonHeader, IonToolbar, IonTitle, IonText, IonInput, IonButton, IonItem, IonCheckbox, IonLabel } from '@ionic/react';\nimport { IonReactRouter } from '@ionic/react-router';\n\n/* Core CSS required for Ionic components to work properly */\nimport '@ionic/react/css/core.css';\n\n/* Basic CSS for apps built with Ionic */\nimport '@ionic/react/css/normalize.css';\nimport '@ionic/react/css/structure.css';\nimport '@ionic/react/css/typography.css';\n\n/* Optional CSS utils that can be commented out */\nimport '@ionic/react/css/padding.css';\nimport '@ionic/react/css/float-elements.css';\nimport '@ionic/react/css/text-alignment.css';\nimport '@ionic/react/css/text-transformation.css';\nimport '@ionic/react/css/flex-utils.css';\nimport '@ionic/react/css/display.css';\n\n/* Theme variables */\nimport './theme/variables.css';\n\n//---------------------------------------------------------------------------------------\n//---------------------------------------------------------------------------------------\n\nimport { authenticate, getUserStatus, logout } from './models/API/UserAPI';\nimport { User } from './models/Other/User';\n\nimport sha256 from \"fast-sha256\";\n\n//---------------------------------------------------------------------------------------\n//---------------------------------------------------------------------------------------\n\nimport './components/css/LogIn.css';\nimport './pages/css/Home.css';\n\nimport Menu from './components/MenuHome';\nimport About from './pages/About';\nimport Contact from './pages/Contact';\nimport UserProfile from './pages/UserProfile';\n\n//---------------------------------------------------------------------------------------\n\nclass App extends React.Component {\n\n  state: {\n    selectedPage: string,\n    menus: string,\n    logged: boolean,\n    loadingAPIcall: boolean,\n    userLogged: User,\n    rememberMe: boolean\n  }\n\n  setRememberMe = (rM: boolean) => {\n    this.setState({ \n      rememberMe: rM\n    });\n  }\n\n  setLogged = (logged: boolean) => {\n\n    if (logged === false) {\n\n      logout(this.state.userLogged.email);      \n      localStorage.clear();\n    }\n\n    this.setState({ \n      logged: logged, \n      menus: logged ? 'user' : 'home'\n    });\n\n  };\n\n  setUser = (user: User) => {\n\n    this.setState({\n      userLogged: user      \n    });\n  }\n\n  constructor(props: any) {\n    \n    super(props);\n\n    this.state = {\n      selectedPage: '',\n      menus: 'home',\n      logged: false,\n      loadingAPIcall: true,\n      userLogged: new User(\"\", \"\", -1, \"\", -1, \"\", \"\", \"\"),\n      rememberMe: false\n    };\n\n  }\n\n  async componentDidMount() {\n\n    console.log(\"com..DidMount() -> updating state...\");\n\n    //await getUserStatus(this.state.userLogged.email)\n    //await getUserStatus(\"test\")\n\n    var emailFromStorage = localStorage.getItem('email');\n\n    console.log(\"Remember? \" + this.state.rememberMe);\n\n    if (emailFromStorage === null) \n      emailFromStorage = this.state.userLogged.email\n    else {\n      var userFromStorage = localStorage.getItem('user');\n      if (userFromStorage != null) {\n        this.setState({\n          userLogged: JSON.parse(userFromStorage)\n        });  \n      }\n    }\n\n    await getUserStatus(emailFromStorage)\n      .then(res => res.json())\n      .then((data) => {\n\n        if (data.status === \"online\") {\n          this.setState({\n            logged: true,\n            menus: 'user',\n            loadingAPIcall: false\n          });\n        } else {\n          this.setState({\n\n            logged: false,\n            menus: 'home',\n            loadingAPIcall: false\n          });\n        }\n\n      });\n    }\n\n  render() {\n\n    console.log(\"[...] Rendering App component...\");\n\n    var logged = this.state.logged;\n\n    return (\n        <IonApp>\n          {\n            this.state.loadingAPIcall ? <div></div> : (\n              <IonReactRouter>\n            \n              <IonSplitPane id=\"split-pane\" contentId=\"main\">\n                <Menu selectedPage={this.state.selectedPage} menus={this.state.menus}/>\n                  \n                  <IonRouterOutlet id=\"main\">\n                    \n                    <Route path=\"/home\" component={(props: any) => {\n                      \n                      if (logged) {\n                        \n                        return <Redirect to=\"/profile\" />;\n                      } \n                      \n                      return <Home logged={logged} {...props} setLogged={this.setLogged} setUser={this.setUser} />;\n    \n                    }} />\n                    <Route path=\"/about\" component={About} exact={true} />\n                    <Route path=\"/contact\" component={Contact} exact={true} />                          \n    \n                    <Route path=\"/profile\" component={(props: any) => {\n                      \n                      if (!logged) {\n                        \n                        return <Redirect to=\"/home\" />;\n                      }\n    \n                      return <Profile setLogged={this.setLogged} user={this.state.userLogged} setRememberMe={this.state.setRememberMe}/>;\n    \n                    }} />\n    \n                    <Redirect exact from=\"/\" to=\"/home\" />\n                  \n                  </IonRouterOutlet>\n                  \n    \n              </IonSplitPane>\n            </IonReactRouter>\n                \n            )\n          }\n        </IonApp>\n      );\n  }\n};\n\nexport default App;\n\n//---------------------------------------------------------------------------------------\n\nclass Home extends React.Component<any> {\n\n  render() {\n\n    return (\n      <IonPage>\n\n\n        <IonHeader>\n          <IonToolbar color=\"primary\">\n            <IonTitle id=\"page-title\">UMFit</IonTitle>\n          </IonToolbar>\n        </IonHeader>\n\n        <LogInForm logged={this.props.logged} history={this.props.history} setLogged={this.props.setLogged} setUser={this.props.setUser} setRememberMe={this.props.setRememberMe}/>\n\n      </IonPage>\n    );\n  }\n\n};\n\n//---------------------------------------------------------------------------------------\n\nclass Profile extends React.Component<any> {\n\n  state = {\n    user: User\n  }\n\n  constructor(props: any) {\n    super(props);\n    this.state = {\n      user: this.props.user\n    };\n  }\n\n  render() {\n\n    return(\n              \n        <IonRouterOutlet>\n\n          <Route path=\"/profile\" render={() => {return <UserProfile user={this.state.user} />}} exact={true} />\n\n          <Route path=\"/profile/logout\" component={() => {return <LogOut setLogged={this.props.setLogged}/>}} exact={true} />\n\n        </IonRouterOutlet>\n      \n    );    \n  }\n\n}\n//---------------------------------------------------------------------------------------\n\nclass LogOut extends React.Component<any> {\n\n  componentDidMount() {\n    this.props.setLogged(false);\n  }\n\n  render() {\n    return <div></div>;\n  }\n}\n\n//---------------------------------------------------------------------------------------\n\nclass LogInForm extends React.Component<any> {\n\n  state: {\n    emailValue: string,\n    passwordValue: string,\n    rememberMe: boolean\n  }\n\n  constructor(props: any) {\n    \n    super(props);\n\n    this.state = {\n      emailValue: \"\",\n      passwordValue: \"\",\n      rememberMe: false\n    }\n  }\n\n  render() {\n\n    return (\n      \n      <div id=\"login-form\">\n          <div id=\"Logo\"></div>\n          <div id=\"phrase\">\n              <IonText>O teu ginásio da UMinho...</IonText>\n          </div>\n      <div id=\"input-form\">\n          <br></br>\n          <IonInput required type=\"email\" id=\"email-input\" placeholder=\"E-Mail\"\n          value={this.state.emailValue}\n          onIonChange={(e) => {\n             \n            this.setState({\n              emailValue: (e.target as HTMLInputElement).value,\n            });\n\n          }}>\n          </IonInput>\n          <br></br>\n          <IonInput required type=\"password\" id=\"pass-input\" placeholder=\"Password\"\n          value={this.state.passwordValue}\n          onIonChange={(e) => {\n\n            this.setState({\n              passwordValue: (e.target as HTMLInputElement).value,\n            });\n\n          }}>\n          </IonInput>\n          <br></br>\n          <IonItem>\n            <IonCheckbox color=\"primary\" slot=\"start\" onIonChange={(e) => {\n                this.setState({\n                  rememberMe: (e.target as HTMLInputElement).checked\n                });\n            }}></IonCheckbox>\n            <IonLabel>Remember me</IonLabel>\n          </IonItem>\n      </div>\n      <div>\n      <IonButton expand=\"block\" type=\"submit\" id=\"login-button\" onClick={async () => {\n              \n              //setShowLoading(true);\n\n              let pass_enc = new TextEncoder();\n              let encoded = pass_enc.encode(this.state.passwordValue);\n              let hash256 = Buffer.from(sha256(encoded)).toString('hex').toUpperCase();\n\n              console.log(\"Para a API: /api/user/authenticate\");\n              console.log(\"> E-Mail: \" + this.state.emailValue);\n              console.log(\"> Password: \" + this.state.passwordValue);\n              console.log(\"> Password (sha256): \" + hash256);\n\n              //request\n              let response = authenticate(this.state.emailValue, this.state.passwordValue);\n\n              await response.then(async (value) => {\n                  \n                  //Success OK = 200    \n                  if (value.status === 200) {\n                                   \n                      var json = value.json();\n                      //var json: User = await value.json();\n                     \n                      await json.then((value) => {\n                          \n                          var user: User = value;\n\n                          this.props.setLogged(true);\n                          this.props.setUser(user);\n                          this.props.setRememberMe(this.state.rememberMe);\n\n                          localStorage.setItem(\"email\", user.email);\n                          localStorage.setItem(\"user\", JSON.stringify(user));\n\n                          //this.props.history.replace(\"/profile\");\n                      });\n\n                  //Login error: 400    \n                  } else {\n\n                      alert(\"E-mail ou password incorretos...\");\n\n                  }\n              });\n\n              //for debug\n              //this.props.setLogged(true);\n\n          }\n      }>\n          Log-In\n      </IonButton>\n      </div>\n    </div> \n  );\n  }\n\n  \n};\n"]},"metadata":{},"sourceType":"module"}